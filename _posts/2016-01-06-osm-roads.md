---
layout: post
category: graphics
title: Rendering roads from OSM data
tags: graphics maps
summary: How to render roads from the OSM data and improve performance
image: img/posts/header.gif
---

For the first part of this post I invite you to take a look at my colleague's [post](http://ssarangi.github.io/OpenStreetMapsRendering-and-simple-routing/) where he describes the data layout of OSM and talks about rendering it in matplotlib.

### Starting point

In this post I shall describe the technique used to render the OSM data in an OpenGL environment and some performance improvements that were conducted.

First, this is what was is obtained if vispy's data is rendered as is:

![Initial](/img/vispy/initial.png "Initial")

And finally we were able to obtain the following image:

![Final](/img/vispy/vispy_rendering.png "Final")


### Why is this a problem?

At first glance it'd seem that the easiest way to render a thick line when we have a thin one is to increase the line thickness. This mostly works but there is something unappealing about the result. It looks as if a child has abruptly stacked some rail road tracks end to end without taking the time to join them. I no longer have images to show how they looked but the following diagram is a good approximation.

![Rail](/img/vispy/railtracks.JPG "Line widths")

### The door approach

I think of this as rather like a door. Say the coordinates of a line in a plane are (x, y, z) and (x1, y1, z1), I create two new points (x, y, z+offset) and (x1,y1, z1+offset). If you were to drop a plumb line from each of these points then the new points would have the same x and y coordinates but the z value would change by some amount.

Now join the original two points to get the equation of a line and using that line as an axis rotate the new points by 90 degrees. This will raise the new points to the z same level as the original points. In the figure below the line in red is what is obtained by joining the two new points obtained after rotation.

![Door](/img/vispy/door.JPG "The door approach")  
