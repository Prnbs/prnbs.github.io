---
layout: post
category: graphics
title: Rendering roads from OSM data
tags: graphics maps
summary: How to render roads from the OSM data and improve performance
image: img/posts/header.gif
---

For the first part of this post I invite you to take a look at my colleague's [post](http://ssarangi.github.io/OpenStreetMapsRendering-and-simple-routing/) where he describes the data layout of OSM and talks about rendering it in matplotlib.

### Starting point

In this post I shall describe the technique used to render the OSM data in an OpenGL environment and some performance improvements that were conducted.

First, this is what was is obtained if vispy's data is rendered as is:

![Initial](/img/vispy/initial.png "Initial")

And finally we were able to obtain the following image:

![Final](/img/vispy/vispy_rendering.png "Final")


### Why is this a problem?

At first glance it'd seem that the easiest way to render a thick line when we have a thin one is to increase the line thickness. This mostly works but there is something unappealing about the result. It looks as if a child has abruptly stacked some rail road tracks end to end without taking the time to join them.


#### Teleporting cops

This usually happens when all the players are in a straight stretch of road. The first thing that happens is that all the cops bundle together to form a group. This means that if cop 1 was leading, followed by cop 2 and then 3, suddenly 2 and 3 will rush ahead and be co-incident with 1.

This happens (most likely) because of the way that the animation is performed.

```
var waypoint = turf.along(this.linestring, (this.increment * this.trip_distance * this.pollingInterval) / (this.trip_duration * 1000 * 1000), 'miles').geometry.coordinates;

```

The polling interval is a constant value and the increment is an integer value that is increased by 1 at every frame update. The best guess that we have right now is that the bug lies in the values returned by this function.

![Bloopers](/img/heist/bloopers.gif "Bloopers")
Refresh the page if the above image does not animate.
